- name: Windows update
  hosts: all
  tasks:
  # https://docs.ansible.com/ansible/latest/modules/win_updates_module.html
  - name: Update windows
      win_updates:
      # category_names:
      #   - SecurityUpdates
      #   - CriticalUpdates
      #   - UpdateRollups
      state: installed
      # reboot: yes
    register: result_update
    when: ansible_os_family == "Windows"

  - name: Report windows update
    debug: var=result_update

  - name: Report reboot required
    debug: var=[ansible_hostname,result_update.reboot_required]
    when: result_update.reboot_required
  